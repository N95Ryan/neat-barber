---
import { ViewTransitions } from "astro:transitions";

export interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "Neat Barber Paris - Salon de coiffure moderne au cœur de Paris",
} = Astro.props;
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/src/styles/global.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Hanken+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen" />

    <!-- SlickNav CSS -->
    <link href="/css/slicknav.min.css" rel="stylesheet" />

    <!-- Swiper CSS -->
    <link rel="stylesheet" href="/css/swiper-bundle.min.css" />

    <!-- Font Awesome CSS -->
    <link href="/css/all.min.css" rel="stylesheet" media="screen" />
    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Animated CSS -->
    <link href="/css/animate.css" rel="stylesheet" />

    <!-- Magnific CSS -->
    <link href="/css/magnific-popup.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link href="/css/custom.css" rel="stylesheet" media="screen" />

    <!-- Blog CSS -->
    <link href="/src/styles/blog-override.css" rel="stylesheet" />

    <!-- View Transitions CSS -->
    <link href="/src/styles/transitions.css" rel="stylesheet" />

    <!-- Astro View Transitions -->
    <ViewTransitions />
  </head>
  <body class="tt-magic-cursor">
    <!-- Preloader Start -->
    <div class="preloader">
      <div class="loading-container">
        <div class="loading"></div>
        <div id="loading-icon"><img src="/images/loader.svg" alt="" /></div>
      </div>
    </div>
    <!-- Preloader End -->

    <!-- Transition Progress Indicator -->
    <div id="transition-progress" class="transition-progress"></div>

    <!-- Magic Cursor Start -->
    <div id="magic-cursor">
      <div id="ball"></div>
    </div>
    <!-- Magic Cursor End -->

    <slot />

    <!-- Scripts -->
    <script is:inline src="/js/jquery-3.7.1.min.js"></script>
    <script is:inline src="/js/bootstrap.min.js"></script>
    <script is:inline src="/js/validator.min.js"></script>
    <script is:inline src="/js/jquery.slicknav.js"></script>
    <script is:inline src="/js/swiper-bundle.min.js"></script>
    <script is:inline src="/js/jquery.waypoints.min.js"></script>
    <script is:inline src="/js/jquery.counterup.min.js"></script>
    <script is:inline src="/js/jquery.magnific-popup.min.js"></script>
    <script is:inline src="/js/SmoothScroll.js"></script>
    <script is:inline src="/js/gsap.min.js"></script>
    <script is:inline src="/js/magiccursor.js"></script>
    <script is:inline src="/js/splitType.js"></script>
    <script is:inline src="/js/ScrollTrigger.min.js"></script>
    <script is:inline src="/js/wow.js"></script>
    <script is:inline src="/js/function.js"></script>

    <!-- View Transitions Management Script -->
    <script>
      // Vérifier le support de prefers-reduced-motion
      const prefersReducedMotion = () =>
        window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      // Gestion des transitions de page
      document.addEventListener("astro:before-preparation", () => {
        // Sauvegarder la position de scroll actuelle
        sessionStorage.setItem("lastScrollPosition", window.scrollY.toString());

        // Ajouter une classe de transition au body
        document.body.classList.add("astro-transition");

        // Afficher le progress indicator
        const progressBar = document.getElementById("transition-progress");
        if (progressBar && !prefersReducedMotion()) {
          progressBar.classList.add("active");
        }
      });

      document.addEventListener("astro:after-swap", () => {
        // Fermer le menu mobile s'il est ouvert
        const mobileMenu = document.getElementById("mobileMenuOverlay");
        const burgerBtn = document.getElementById("burgerMenuBtn");
        if (mobileMenu?.classList.contains("active")) {
          mobileMenu.classList.remove("active");
          burgerBtn?.classList.remove("active");
          document.body.style.overflow = "";
        }

        // Réinitialiser la position de scroll
        window.scrollTo(0, 0);

        // Nettoyer les animations WOW.js
        if (window.WOW) {
          new (window as any).WOW().init();
        } else {
          console.error("WOW.js n'est pas chargé");
        }
      });

      document.addEventListener("astro:page-load", () => {
        // Masquer le progress indicator
        const progressBar = document.getElementById("transition-progress");
        if (progressBar) {
          progressBar.classList.remove("active");
        }

        // Retirer la classe de transition
        document.body.classList.remove("astro-transition");

        // Réinitialiser les listeners du navbar
        initializeNavbarListeners();

        // Réinitialiser les animations globales
        if ((window as any).WOW) {
          new (window as any).WOW().init();
        }

        // Disparaître le preloader progressivement
        const preloader = document.querySelector(".preloader");
        if (preloader && !preloader.classList.contains("hidden")) {
          preloader.classList.add("fade-out");
          setTimeout(() => {
            preloader?.classList.add("hidden");
          }, 500);
        }
      });

      // Initialiser les event listeners du navbar
      function initializeNavbarListeners() {
        const burgerBtn = document.getElementById("burgerMenuBtn");
        const closeBtn = document.getElementById("closeMenuBtn");
        const mobileMenu = document.getElementById("mobileMenuOverlay");
        const body = document.body;

        function openMenu() {
          burgerBtn?.classList.add("active");
          mobileMenu?.classList.add("active");
          body.style.overflow = "hidden";
        }

        function closeMenu() {
          burgerBtn?.classList.remove("active");
          mobileMenu?.classList.remove("active");
          body.style.overflow = "";
        }

        // Nettoyer les anciens listeners
        burgerBtn?.replaceWith(burgerBtn.cloneNode(true));
        closeBtn?.replaceWith(closeBtn.cloneNode(true));

        // Réajouter les listeners
        const newBurgerBtn = document.getElementById("burgerMenuBtn");
        const newCloseBtn = document.getElementById("closeMenuBtn");
        const newMobileMenu = document.getElementById("mobileMenuOverlay");

        newBurgerBtn?.addEventListener("click", openMenu);
        newCloseBtn?.addEventListener("click", closeMenu);

        newMobileMenu?.addEventListener("click", (e) => {
          if (e.target === newMobileMenu) {
            closeMenu();
          }
        });

        document.addEventListener("keydown", (e) => {
          if (
            e.key === "Escape" &&
            newMobileMenu?.classList.contains("active")
          ) {
            closeMenu();
          }
        });

        const mobileLinks = document.querySelectorAll(".mobile-menu-link");
        mobileLinks.forEach((link) => {
          link.addEventListener("click", closeMenu);
        });
      }

      // Initialiser au chargement de la page
      initializeNavbarListeners();
    </script>
  </body>
</html>
