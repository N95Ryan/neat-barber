---
export interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "Neat Barber Paris - Salon de coiffure moderne au c≈ìur de Paris",
} = Astro.props;
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <!-- Google Tag Manager -->
    <script is:inline>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-P94C5H49");
    </script>
    <!-- End Google Tag Manager -->

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/src/styles/global.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Hanken+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS (Grid only) -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen" />

    <!-- Swiper CSS (Testimonials carousel) -->
    <link rel="stylesheet" href="/css/swiper-bundle.min.css" />

    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Custom CSS Optimized (1900 lines, -40% du poids) -->
    <link href="/css/custom.clean.css" rel="stylesheet" media="screen" />

    <!-- Modern Animations CSS -->
    <link href="/src/styles/animations.css" rel="stylesheet" />

    <!-- Mobile Menu CSS -->
    <link href="/src/styles/mobile-menu.css" rel="stylesheet" />

    <!-- Blog CSS -->
    <link href="/src/styles/blog-override.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-P94C5H49"
        height="0"
        width="0"
        style="display:none;visibility:hidden"></iframe></noscript
    >
    <!-- End Google Tag Manager (noscript) -->

    <!-- Preloader Start -->
    <div class="preloader">
      <div class="loading-container">
        <div class="loading"></div>
        <div id="loading-icon"><img src="/images/loader.svg" alt="" /></div>
      </div>
    </div>
    <!-- Preloader End -->

    <slot />

    <!-- Swiper JS (only for testimonials carousel) -->
    <script is:inline src="/js/swiper-bundle.min.js"></script>

    <!-- Initialize Swiper for testimonials -->
    <script is:inline>
      document.addEventListener("DOMContentLoaded", function () {
        const testimonialCarousel = document.querySelector(
          ".testimonial-carousel .swiper"
        );
        if (testimonialCarousel) {
          new Swiper(".testimonial-carousel .swiper", {
            slidesPerView: 1,
            speed: 1000,
            spaceBetween: 30,
            loop: true,
            autoplay: {
              delay: 5000,
            },
            pagination: {
              el: ".swiper-pagination",
              clickable: true,
            },
            breakpoints: {
              768: {
                slidesPerView: 2,
                spaceBetween: 20,
              },
              991: {
                slidesPerView: 2,
              },
            },
          });
        }
      });
    </script>

    <!-- Main Scripts - Inline dans Astro -->
    <script>
      // Preloader
      window.addEventListener("load", () => {
        const preloader = document.querySelector<HTMLElement>(".preloader");
        if (preloader) {
          preloader.style.opacity = "0";
          preloader.style.transition = "opacity 0.6s ease";
          setTimeout(() => {
            preloader.style.display = "none";
          }, 600);
        }
      });

      // Sticky Header
      function initStickyHeader() {
        const header =
          document.querySelector<HTMLElement>("header.main-header");
        const headerSticky = document.querySelector<HTMLElement>(
          "header .header-sticky"
        );

        if (!header || !headerSticky) return;

        function setHeaderHeight() {
          if (header && headerSticky) {
            header.style.height = `${headerSticky.offsetHeight}px`;
          }
        }

        function handleScroll() {
          if (!headerSticky) return;
          const scrollTop =
            window.pageYOffset || document.documentElement.scrollTop;
          const headerHeight = headerSticky.offsetHeight;

          if (scrollTop > headerHeight + 100) {
            headerSticky.classList.add("hide");
          } else {
            headerSticky.classList.remove("hide");
          }

          if (scrollTop > 800) {
            headerSticky.classList.add("active");
          } else {
            headerSticky.classList.remove("active");
          }
        }

        setHeaderHeight();
        window.addEventListener("scroll", handleScroll, { passive: true });
        window.addEventListener("resize", setHeaderHeight, { passive: true });
      }

      // Counter Animation
      function initCounters() {
        const counters = document.querySelectorAll<HTMLElement>(".counter");
        if (counters.length === 0) return;

        function animateCounter(
          element: HTMLElement,
          target: number,
          duration = 2000
        ) {
          let current = 0;
          const increment = target / (duration / 16);
          const step = () => {
            current += increment;
            if (current < target) {
              element.textContent = Math.floor(current).toString();
              requestAnimationFrame(step);
            } else {
              element.textContent = target.toString();
            }
          };
          step();
        }

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const counter = entry.target as HTMLElement;
                const target = parseInt(
                  counter.getAttribute("data-target") ||
                    counter.textContent ||
                    "0"
                );
                if (!counter.classList.contains("animated")) {
                  counter.classList.add("animated");
                  animateCounter(counter, target);
                }
              }
            });
          },
          { threshold: 0.5 }
        );

        counters.forEach((counter) => {
          if (!counter.hasAttribute("data-target")) {
            counter.setAttribute("data-target", counter.textContent || "0");
          }
          observer.observe(counter);
        });
      }

      // Animations
      function initAnimations() {
        const elements = document.querySelectorAll<HTMLElement>(
          ".wow, [data-animate]"
        );
        if (elements.length === 0) return;

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const element = entry.target as HTMLElement;
                const delay =
                  element.getAttribute("data-wow-delay") ||
                  element.getAttribute("data-delay") ||
                  "0";
                // Convert number to seconds if needed
                const delayValue =
                  typeof delay === "string" && !delay.includes("s")
                    ? `${delay}s`
                    : delay;
                element.style.animationDelay = delayValue;
                element.classList.add("animated");
                observer.unobserve(element);
              }
            });
          },
          { threshold: 0.1, rootMargin: "0px 0px -50px 0px" }
        );

        elements.forEach((element) => {
          // Only hide .wow elements, not [data-animate] elements
          if (element.classList.contains("wow")) {
            element.style.opacity = "0";
          }
          observer.observe(element);
        });
      }

      // Text animations
      function initTextAnimations() {
        const textElements =
          document.querySelectorAll<HTMLElement>(".text-anime");
        if (textElements.length === 0) return;

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const element = entry.target as HTMLElement;
                element.classList.add("animate-text");
                observer.unobserve(element);
              }
            });
          },
          { threshold: 0.1 }
        );

        textElements.forEach((element) => observer.observe(element));
      }

      // Reveal animations
      function initRevealAnimations() {
        const revealElements =
          document.querySelectorAll<HTMLElement>(".reveal");
        if (revealElements.length === 0) return;

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const element = entry.target as HTMLElement;
                element.classList.add("revealed");
                observer.unobserve(element);
              }
            });
          },
          { threshold: 0.2 }
        );

        revealElements.forEach((element) => observer.observe(element));
      }

      // Mobile Menu
      function initMobileMenu() {
        const menu = document.querySelector<HTMLElement>("#menu");
        const responsiveMenu =
          document.querySelector<HTMLElement>(".responsive-menu");

        if (!menu || !responsiveMenu) return;

        const mobileMenuHTML = `
          <button class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false">
            <span class="menu-icon">
              <span class="menu-icon-bar"></span>
              <span class="menu-icon-bar"></span>
              <span class="menu-icon-bar"></span>
            </span>
          </button>
          <nav class="mobile-menu-nav" aria-hidden="true">
            ${menu.innerHTML}
          </nav>
        `;

        responsiveMenu.innerHTML = mobileMenuHTML;

        const toggleButton = responsiveMenu.querySelector<HTMLButtonElement>(
          ".mobile-menu-toggle"
        );
        const nav =
          responsiveMenu.querySelector<HTMLElement>(".mobile-menu-nav");

        if (!toggleButton || !nav) return;

        toggleButton.addEventListener("click", () => {
          const isExpanded =
            toggleButton.getAttribute("aria-expanded") === "true";
          toggleButton.setAttribute("aria-expanded", String(!isExpanded));
          toggleButton.classList.toggle("active");
          nav.classList.toggle("active");
          nav.setAttribute("aria-hidden", String(isExpanded));
          document.body.style.overflow = isExpanded ? "" : "hidden";
        });

        const menuLinks = nav.querySelectorAll("a");
        menuLinks.forEach((link) => {
          link.addEventListener("click", () => {
            toggleButton.setAttribute("aria-expanded", "false");
            toggleButton.classList.remove("active");
            nav.classList.remove("active");
            nav.setAttribute("aria-hidden", "true");
            document.body.style.overflow = "";
          });
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && nav.classList.contains("active")) {
            toggleButton.click();
          }
        });
      }

      // Initialize all
      function init() {
        initStickyHeader();
        initMobileMenu();
        initCounters();
        initAnimations();
        initTextAnimations();
        initRevealAnimations();
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        init();
      }
    </script>
  </body>
</html>
